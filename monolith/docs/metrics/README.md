# Внедрение системы метрик в проект с использованием Prometheus и Grafana

## Сущности
1. Prometheus – опенсорс ПО, используемое для мониторинга событий и оповещения.

2. Grafana – опенсорс ПО для анализа и визуализации данных.

## Метрики:
1. RPS на эндпоинты – для выявления возможных bottlneck-ов.

2. Время выполнения запросов – для выявления возможных bottlneck-ов.

3. Использование CPU и памяти сервера – для прогнозирования вертикального масштабирования.

## Какие метрики уже есть:
1. Отсутствуют.

## Сбор данных для метрик:
Для этого нам понадобится библиотека prometheus/client_golang.
Для сбора метрик будут использоваться две структуры: GaugeVec для измерения RPS и HistogramVec для измерения времени выполнения запроса.

## Визуализация:
Для этого необходимо настроить дашборд в Grafana.

## План внедрения:
1. В каталоге internal/infrastructure/metrics создадим файл metrics.go. 
В нем определим структуру PrometheusMetrics, в которой будет композиция структур, описанных выше. Так же определим методы, с помощью которых будут собираться метрики.
2. В местах программы, где нам необходимо собирать метрики, мы добавим структуру PrometheusMetrics для доступа к ее методам. Так же нам необходимо добавить хэндлер, через который Prometheus сможет собирать метрики. Для изоляции этого URI необходимо будет создать отдельный роутер, который будет работать в 127.0.0.1 сети.
3. Далее нужно добавить в docker-compose.yml два сервиса – Prometheus и Grafana, создать конфигурационный файл для Prometheus и пробросить его в контейнер по пути /etc/prometheus/prometheus.yml.
4. Для завершения внедрения системы мониторинга необходимо зайти в Grafana, настроить дашборд, закоммитить образ и запушить его в DockerHub или корпоративный репозиторий.

## Преимущества:
Мониторинг нагрузки поможет нам выявить узкие места в приложении, следить за нагрузкой на hardware сервера и  вовремя среагировать для масштабирования.